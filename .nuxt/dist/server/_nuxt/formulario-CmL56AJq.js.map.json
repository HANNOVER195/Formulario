{"file":"formulario-CmL56AJq.js","mappings":"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","names":["_ssrRenderList","clientes","_ssrInterpolate","_ssrRenderAttr","_ssrIncludeBooleanAttr","_ssrLooseContain","_ssrLooseEqual","_unref"],"sources":["../../../../pages/formulario.vue"],"sourcesContent":["<template>\r\n <button\r\n  @click=\"$router.push('/menu')\"\r\n  class=\"bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded transition m-5\"\r\n>\r\n  Volver a página principal\r\n</button>\r\n  <main class=\"max-w-7xl mx-auto p-8 bg-gray-900 rounded-lg shadow-lg text-gray-300 mb-5\">\r\n    <h1 class=\"text-3xl font-semibold mb-6 text-gray-200\">Crear Nuevo Formulario</h1>\r\n\r\n    <form @submit.prevent=\"handleSubmit\" class=\"space-y-8\">\r\n      <!-- NUEVO: Selector de Cliente -->\r\n\r\n\r\n      <div class=\"mb-6 bg-gray-800 p-4 rounded border border-gray-700 text-gray-200\">\r\n        <label for=\"clientSelect\" class=\"block mb-1 font-medium\">Seleccionar Cliente</label>\r\n        <select\r\n          id=\"clientSelect\"\r\n          v-model=\"selectedClientId\"\r\n          @change=\"onClientChange\"\r\n          class=\"w-full rounded border border-gray-700 bg-gray-900 px-3 py-2 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-gray-500 text-gray-200\"\r\n        >\r\n          <option value=\"\">-- Selecciona un cliente --</option>\r\n          <option\r\n            v-for=\"clientes in clientes\"\r\n            :key=\"clientes.id\"\r\n            :value=\"clientes.id\"\r\n          >\r\n            {{ clientes.name }}\r\n          </option>\r\n        </select>\r\n      </div>\r\n\r\n\r\n      <!-- Nombre del formulario -->\r\n      <div>\r\n        <label for=\"formName\" class=\"block text-gray-400 font-medium mb-2\">Nombre del formulario</label>\r\n        <input\r\n          v-model=\"formName\"\r\n          id=\"formName\"\r\n          type=\"text\"\r\n          placeholder=\"Ej: Encuesta de satisfacción\"\r\n          required\r\n          class=\"w-full border border-gray-700 bg-gray-800 rounded-md px-4 py-2 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-gray-500 transition text-gray-200\"\r\n        />\r\n      </div>\r\n\r\n      <div class=\"mb-6 bg-gray-800 p-4 rounded border border-gray-700 text-gray-200\">\r\n        <h2 class=\"text-lg font-semibold mb-4\">Información de la empresa</h2>\r\n        \r\n        <div class=\"mb-4\">\r\n          <label for=\"companyName\" class=\"block mb-1 font-medium\">Nombre de la empresa/entidad</label>\r\n          <input\r\n            id=\"companyName\"\r\n            v-model=\"companyName\"\r\n            type=\"text\"\r\n            placeholder=\"Ej: ACME Ltda.\"\r\n            class=\"w-full rounded border border-gray-700 bg-gray-900 px-3 py-2 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-gray-500\"\r\n          />\r\n        </div>\r\n        \r\n        <div class=\"mb-4\">\r\n          <label for=\"attentionName\" class=\"block mb-1 font-medium\">Atención a</label>\r\n          <input\r\n            id=\"attentionName\"\r\n            v-model=\"attentionName\"\r\n            type=\"text\"\r\n            placeholder=\"Ej: Juan Pérez\"\r\n            class=\"w-full rounded border border-gray-700 bg-gray-900 px-3 py-2 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-gray-500\"\r\n          />\r\n        </div>\r\n\r\n        <div class=\"mb-4\">\r\n          <label for=\"emailName\" class=\"block mb-1 font-medium\">Email</label>\r\n          <input\r\n            id=\"emailName\"\r\n            v-model=\"emailName\"\r\n            type=\"text\"\r\n            placeholder=\"Ej: FME@gmail.com\"\r\n            class=\"w-full rounded border border-gray-700 bg-gray-900 px-3 py-2 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-gray-500\"\r\n          />\r\n        </div>\r\n\r\n        <div class=\"mb-4\">\r\n          <label for=\"contacName\" class=\"block mb-1 font-medium\">Contacto</label>\r\n          <input\r\n            id=\"contacName\"\r\n            v-model=\"contacName\"\r\n            type=\"text\"\r\n            placeholder=\"Ej: FME@gmail.com\"\r\n            class=\"w-full rounded border border-gray-700 bg-gray-900 px-3 py-2 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-gray-500\"\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n\r\n      <!-- Descripción general previa al formulario -->\r\n      <div class=\"mb-8\">\r\n  <h2 class=\"text-xl font-semibold text-gray-200 mb-4\">Secciones de Texto</h2>\r\n  \r\n  <div v-for=\"(textSection, index) in textSections\" :key=\"index\" class=\"mb-4 relative\">\r\n    <textarea\r\n      v-model=\"textSection.content\"\r\n      rows=\"4\"\r\n      placeholder=\"Escribe aquí detalles o descripción\"\r\n      class=\"w-full rounded border border-gray-700 bg-gray-800 px-4 py-2 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-gray-500 text-gray-200\"\r\n    ></textarea>\r\n    \r\n    <button\r\n      type=\"button\"\r\n      @click=\"removeTextSection(index)\"\r\n      class=\"absolute top-0 right-0 mt-1 mr-1 text-red-500 hover:text-red-700 font-bold text-xl\"\r\n      aria-label=\"Eliminar sección de texto\"\r\n    >\r\n      &times;\r\n    </button>\r\n  </div>\r\n  \r\n  <button\r\n    type=\"button\"\r\n    @click=\"addTextSection\"\r\n    class=\"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded text-gray-200\"\r\n  >\r\n    + Agregar sección de texto\r\n  </button>\r\n</div>\r\n\r\n\r\n\r\n      <!-- Secciones dinámicas -->\r\n<div v-for=\"(section, sIndex) in sections\" :key=\"sIndex\" class=\"border border-gray-700 rounded p-4 mb-6\">\r\n\r\n  <!-- Título de la sección -->\r\n  <div class=\"flex justify-between items-center mb-4\">\r\n    <input\r\n      v-model=\"section.title\"\r\n      type=\"text\"\r\n      placeholder=\"Título de la sección\"\r\n      class=\"flex-grow rounded border border-gray-700 bg-gray-800 px-3 py-2 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-gray-500 text-gray-200\"\r\n      required\r\n    />\r\n    <button\r\n      type=\"button\"\r\n      @click=\"removeSection(sIndex)\"\r\n      class=\"ml-4 text-red-500 hover:text-red-700 font-bold\"\r\n      aria-label=\"Eliminar sección\"\r\n    >\r\n      &times;\r\n    </button>\r\n  </div>\r\n\r\n  <!-- Campos de la sección con inputs -->\r\n  <div\r\n    v-for=\"(field, fIndex) in section.fields\"\r\n    :key=\"fIndex\"\r\n    class=\"flex flex-col md:flex-row md:items-center md:space-x-4 mb-4\"\r\n  >\r\n    <!-- Nombre del producto -->\r\n    <input\r\n      v-model=\"field.label\"\r\n      type=\"text\"\r\n      placeholder=\"Nombre del producto\"\r\n      class=\"flex-grow rounded border border-gray-700 bg-gray-800 px-3 py-2 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-gray-500 text-gray-200 mb-2 md:mb-0\"\r\n      required\r\n    />\r\n\r\n    <!-- Cantidad con botones -->\r\n    <div class=\"flex items-center space-x-2\">\r\n      \r\n      <input\r\n        v-model.number=\"field.quantity\"\r\n        type=\"number\"\r\n        min=\"1\"\r\n        placeholder=\"Cantidad\"\r\n        class=\"w-25 text-center rounded border border-gray-700 bg-gray-800 px-3 py-2 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-gray-500 text-gray-200\"\r\n        required\r\n      />\r\n      \r\n    </div>\r\n\r\n    <!-- Unidad de medida -->\r\n    <select\r\n      v-model=\"field.unit\"\r\n      class=\"w-32 rounded border border-gray-700 bg-gray-800 px-3 py-2 text-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500 mb-2 md:mb-0\"\r\n    >\r\n      <option value=\"unidad\">Unidad</option>\r\n      <option value=\"metro\">Metro</option>\r\n      <option value=\"litro\">Litro</option>\r\n      <option value=\"kg\">Kg</option>\r\n      <option value=\"otro\">Otro</option>\r\n    </select>\r\n\r\n    \r\n\r\n    <!-- Valor unitario -->\r\n    <input\r\n      v-model.number=\"field.unitPrice\"\r\n      type=\"number\"\r\n      min=\"0\"\r\n      step=\"0.01\"\r\n      placeholder=\"Valor unitario\"\r\n      class=\"w-40 rounded border border-gray-700 bg-gray-800 px-3 py-2 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-gray-500 text-gray-200 mb-2 md:mb-0\"\r\n      required\r\n    />\r\n\r\n    \r\n\r\n    <!-- Total por producto -->\r\n    <div class=\"ml-auto text-gray-300 font-semibold\">\r\n       Total: ${{ Math.round((Number(field.unitPrice) || 0) * (Number(field.quantity) || 0)) }}\r\n    </div>\r\n\r\n    <!-- Botón eliminar campo -->\r\n    <button\r\n      type=\"button\"\r\n      @click=\"removeField(sIndex, fIndex)\"\r\n      class=\"ml-4 text-red-500 hover:text-red-700 font-bold text-xl\"\r\n      aria-label=\"Eliminar producto\"\r\n    >\r\n      &times;\r\n    </button>\r\n  </div>\r\n\r\n      <!-- Total de la sección alineado a la derecha -->\r\n      <div class=\"flex justify-end font-semibold text-gray-300 mt-2\">\r\n        Total sección: ${{ Math.round(totalPorSeccion[sIndex] || 0) }}\r\n      </div>\r\n\r\n      <!-- Botón agregar campo -->\r\n      <button\r\n        type=\"button\"\r\n        @click=\"addField(sIndex)\"\r\n        class=\"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded text-gray-200\"\r\n      >\r\n        + Agregar producto\r\n      </button>\r\n    </div>\r\n\r\n\r\n\r\n      <button\r\n        type=\"button\"\r\n        @click=\"addSection\"\r\n        class=\"px-6 py-3 bg-gray-800 hover:bg-gray-700 rounded text-gray-200 font-semibold\"\r\n      >\r\n        + Agregar sección\r\n      </button>\r\n\r\n      <!-- Resumen de totales por sección -->\r\n<div class=\"bg-gray-800 border border-gray-700 rounded p-4 mb-6\">\r\n  <h2 class=\"text-lg font-semibold text-gray-200 mb-3\">Total de servicio</h2>\r\n  <ul class=\"space-y-2\">\r\n    <li\r\n      v-for=\"(sectionTotal, index) in totalPorSeccion\"\r\n      :key=\"index\"\r\n      class=\"flex justify-between text-gray-300\"\r\n    >\r\n      <span>{{ sections[index].title || `Sección ${index + 1}` }}</span>\r\n      <span>$ {{ Math.round(sectionTotal || 0) }}</span>\r\n    </li>\r\n  </ul>\r\n  <div class=\"mt-4 text-right font-bold text-gray-100 text-lg border-t border-gray-600 pt-2\">\r\n    TOTAL NETO: ${{ Math.round(totalGeneral || 0) }}\r\n  </div>\r\n</div>\r\n\r\n<div class=\"bg-gray-800 border border-gray-700 rounded p-4 mb-6\">\r\n  <h2 class=\"text-lg font-semibold text-gray-200 mb-3\">Resumen Financiero</h2>\r\n  <ul class=\"space-y-2 text-gray-300\">\r\n    <li class=\"flex justify-between items-center space-x-2\">\r\n      <span>Gastos SSO, adm y util</span>\r\n      <input\r\n        type=\"number\"\r\n        min=\"0\"\r\n        max=\"100\"\r\n        v-model.number=\"utilidadPorcentaje\"\r\n        class=\"w-16 rounded border border-gray-700 bg-gray-900 px-2 py-1 text-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500\"\r\n      />\r\n      <span>%</span>\r\n      <span class=\"ml-auto\">$ {{ Math.round(gastosSSO || 0) }}</span>\r\n    </li>\r\n\r\n    <li class=\"flex justify-between\">\r\n      <span>Neto</span>\r\n      <span>$ {{ Math.round(neto || 0) }}</span>\r\n    </li>\r\n    <li class=\"flex justify-between\">\r\n      <span>IVA (19%)</span>\r\n      <span>$ {{ Math.round(iva || 0) }}</span>\r\n    </li>\r\n    <li class=\"flex justify-between font-bold text-gray-100 border-t border-gray-600 pt-2\">\r\n      <span>TOTAL</span>\r\n      <span>$ {{ Math.round(totalFinal || 0) }}</span>\r\n    </li>\r\n  </ul>\r\n</div>\r\n\r\n\r\n\r\n\r\n      <div>\r\n        <button\r\n          type=\"submit\"\r\n          class=\"w-full py-3 bg-gray-800 hover:bg-gray-700 text-gray-200 font-semibold rounded-md transition\"\r\n        >\r\n          Guardar Formulario\r\n        </button>\r\n      </div>\r\n    </form>\r\n  </main>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted } from 'vue'\r\nimport { db } from '~/firebase/firebase'\r\nimport { collection, getDocs, addDoc, serverTimestamp, query, limit, orderBy   } from 'firebase/firestore'\r\n\r\nconst clientes = ref([])\r\nconst selectedClientId = ref('')\r\n\r\nconst companyName = ref('')\r\nconst attentionName = ref('')\r\nconst emailName = ref('')\r\nconst contacName = ref('')\r\n\r\nasync function loadClients() {\r\n  try {\r\n    const querySnapshot = await getDocs(collection(db, 'clientes'))\r\n    clientes.value = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }))\r\n    console.log('Clientes cargados:', clientes.value)\r\n  } catch (error) {\r\n    console.error('Error cargando clientes:', error)\r\n  }\r\n}\r\n\r\nonMounted(loadClients)\r\n\r\nfunction onClientChange() {\r\n  const client = clientes.value.find(c => c.id === selectedClientId.value)\r\n  if (client) {\r\n    companyName.value = client.name || ''\r\n    attentionName.value = client.contactPerson || ''\r\n    emailName.value = client.email || ''\r\n    contacName.value = client.phone || ''\r\n  } else {\r\n    companyName.value = ''\r\n    attentionName.value = ''\r\n    emailName.value = ''\r\n    contacName.value = ''\r\n  }\r\n}\r\n\r\n\r\nconst formName = ref('')\r\nconst sections = ref([\r\n  {\r\n    title: '',\r\n    fields: [{ label: '', unitPrice: 0, quantity: 1, type: 'text', unit: 'unidad' }]\r\n  }\r\n])\r\n\r\nfunction addSection() {\r\n  sections.value.push({\r\n    title: '',\r\n    fields: [{ label: '', unitPrice: 0, quantity: 1, type: 'text', unit: 'unidad' }]\r\n  })\r\n}\r\n\r\nfunction removeSection(index) {\r\n  sections.value.splice(index, 1)\r\n}\r\n\r\nfunction addField(sectionIndex) {\r\n  sections.value[sectionIndex].fields.push({ label: '', unitPrice: 0, quantity: 1, type: 'text', unit: 'unidad' })\r\n}\r\n\r\nfunction removeField(sectionIndex, fieldIndex) {\r\n  sections.value[sectionIndex].fields.splice(fieldIndex, 1)\r\n}\r\n\r\nasync function generarNumeroCotizacion() {\r\n  const q = query(collection(db, \"formularios\"), orderBy(\"cotizacionId\", \"desc\"), limit(1));\r\n  const snapshot = await getDocs(q);\r\n\r\n  let nuevoId = 1;\r\n  if (!snapshot.empty) {\r\n    const ultimo = snapshot.docs[0].data();\r\n    nuevoId = (ultimo.cotizacionId || 0) + 1;\r\n  }\r\n\r\n  const version = \"01\"; // Siempre fijo en este prototipo\r\n  return { cotizacionId: nuevoId, version };\r\n}\r\n\r\nasync function handleSubmit() {\r\n  try {\r\n    const formRef = collection(db, \"formularios\");\r\n    const { cotizacionId, version } = await generarNumeroCotizacion();\r\n    // Preparar las secciones con totales\r\n    const preparedSections = sections.value.map(section => {\r\n      let totalSection = 0;\r\n      const productsWithTotal = section.fields.map(field => {\r\n        const productTotal = (field.unitPrice || 0) * (field.quantity || 0);\r\n        totalSection += productTotal;\r\n        return {\r\n          ...field,\r\n          total: productTotal\r\n        };\r\n      });\r\n      return {\r\n        title: section.title,\r\n        fields: productsWithTotal,\r\n        totalSection\r\n      };\r\n    });\r\n\r\n    // Total general sumando totales de secciones\r\n    const totalGeneralValue = preparedSections.reduce((acc, section) => acc + section.totalSection, 0);\r\n\r\n    // Totales para resumen financiero\r\n    const gastosSSOValue = totalGeneralValue * (utilidadPorcentaje.value / 100);\r\n    const netoValue = totalGeneralValue + gastosSSOValue;\r\n    const ivaValue = netoValue * 0.19;\r\n    const totalFinalValue = netoValue + ivaValue;\r\n\r\n    // Guardar en Firestore\r\n    await addDoc(formRef, {\r\n      name: formName.value,\r\n      companyName: companyName.value || '',\r\n      attentionName: attentionName.value || '',\r\n      emailName: emailName.value || '',\r\n      contacName: contacName.value || '',\r\n      textSections: textSections.value || [],\r\n      sections: preparedSections,\r\n      totalPorSeccion: preparedSections.map(s => s.totalSection),\r\n      totalGeneral: totalGeneralValue,\r\n      utilidadPorcentaje: utilidadPorcentaje.value, // ← aquí se guarda\r\n      resumenFinanciero: {\r\n        gastosSSO: gastosSSOValue,\r\n        neto: netoValue,\r\n        iva: ivaValue,\r\n        totalFinal: totalFinalValue\r\n      },\r\n      cotizacionId, // 5 dígitos\r\n      version,      // \"01\"\r\n      createdAt: serverTimestamp()\r\n    });\r\n\r\n    alert(\"Formulario guardado exitosamente ✅\");\r\n\r\n    // Resetear formulario\r\n    formName.value = '';\r\n    companyName.value = '';\r\n    attentionName.value = '';\r\n    textSections.value = [];\r\n    sections.value = [\r\n      {\r\n        title: '',\r\n        fields: [{ label: '', unitPrice: 0, quantity: 1 }]\r\n      }\r\n    ];\r\n    utilidadPorcentaje.value = 20; // reset al valor inicial\r\n  } catch (error) {\r\n    console.error(\"Error al guardar el formulario:\", error);\r\n    alert(\"Hubo un error al guardar el formulario ❌\");\r\n  }\r\n}\r\n\r\n\r\n\r\nfunction increaseQuantity(sectionIndex, fieldIndex) {\r\n  sections.value[sectionIndex].fields[fieldIndex].quantity++\r\n}\r\n\r\nfunction decreaseQuantity(sectionIndex, fieldIndex) {\r\n  if (sections.value[sectionIndex].fields[fieldIndex].quantity > 1) {\r\n    sections.value[sectionIndex].fields[fieldIndex].quantity--\r\n  }\r\n}\r\n\r\nconst totalPorSeccion = computed(() =>\r\n  sections.value.map(section =>\r\n    section.fields.reduce(\r\n      (acc, field) => acc + (Number(field.unitPrice) || 0) * (Number(field.quantity) || 0),\r\n      0\r\n    )\r\n  )\r\n)\r\n\r\nconst totalGeneral = computed(() =>\r\n  totalPorSeccion.value.reduce((acc, val) => acc + val, 0)\r\n)\r\nconst utilidadPorcentaje = ref(20) // valor inicial 20%\r\n\r\nconst gastosSSO = computed(() => totalGeneral.value * (utilidadPorcentaje.value / 100))\r\nconst neto = computed(() => totalGeneral.value + gastosSSO.value)\r\nconst iva = computed(() => neto.value * 0.19)\r\nconst totalFinal = computed(() => neto.value + iva.value)\r\n\r\n\r\nconst textSections = ref([\r\n  { content: '' }\r\n])\r\n\r\nfunction addTextSection() {\r\n  textSections.value.push({ content: '' })\r\n}\r\n\r\nfunction removeTextSection(index) {\r\n  textSections.value.splice(index, 1)\r\n}\r\n\r\n\r\n\r\n\r\n</script>\r\n\r\n<style>\r\n/* Chrome, Safari, Edge, Opera */\r\ninput[type=number]::-webkit-inner-spin-button, \r\ninput[type=number]::-webkit-outer-spin-button { \r\n  -webkit-appearance: none; \r\n  margin: 0; \r\n}\r\n\r\n/* Firefox */\r\ninput[type=number] {\r\n  -moz-appearance: textfield;\r\n}\r\n\r\n\r\n</style>"],"version":3}