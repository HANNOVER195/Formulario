import{r as c,l as te,C as x,c as u,a as t,M as oe,N as r,O as L,K as h,L as k,P as i,Q as p,t as m,o as d,R as ae}from"./DN39GKtV.js";import{g as G,c as $,d as j,a as le,s as ne,q as re,l as se,o as ue}from"./G2W-Z_K8.js";const ie={class:"max-w-7xl mx-auto p-8 bg-gray-900 rounded-lg shadow-lg text-gray-300 mb-5"},de={class:"mb-6 bg-gray-800 p-4 rounded border border-gray-700 text-gray-200"},ce=["value"],me={class:"mb-6 bg-gray-800 p-4 rounded border border-gray-700 text-gray-200"},ge={class:"mb-4"},pe={class:"mb-4"},be={class:"mb-4"},ye={class:"mb-4"},fe={class:"mb-8"},ve=["onUpdate:modelValue"],xe=["onClick"],he={class:"flex justify-between items-center mb-4"},Ne=["onUpdate:modelValue"],we=["onClick"],Se=["onUpdate:modelValue"],Ve={class:"flex items-center space-x-2"},ke=["onUpdate:modelValue"],Ce=["onUpdate:modelValue"],Ue=["onUpdate:modelValue"],qe={class:"ml-auto text-gray-300 font-semibold"},_e=["onClick"],Ee={class:"flex justify-end font-semibold text-gray-300 mt-2"},Me=["onClick"],Pe={class:"bg-gray-800 border border-gray-700 rounded p-4 mb-6"},Te={class:"space-y-2"},$e={class:"mt-4 text-right font-bold text-gray-100 text-lg border-t border-gray-600 pt-2"},je={class:"bg-gray-800 border border-gray-700 rounded p-4 mb-6"},Fe={class:"space-y-2 text-gray-300"},Ae={class:"flex justify-between items-center space-x-2"},Oe={class:"ml-auto"},ze={class:"flex justify-between"},Le={class:"flex justify-between"},Ge={class:"flex justify-between font-bold text-gray-100 border-t border-gray-600 pt-2"},Re={__name:"formulario",setup(Be){const C=c([]),_=c(""),b=c(""),y=c(""),N=c(""),w=c("");async function B(){try{const a=await G($(j,"clientes"));C.value=a.docs.map(e=>({id:e.id,...e.data()})),console.log("Clientes cargados:",C.value)}catch(a){console.error("Error cargando clientes:",a)}}te(B);function D(){const a=C.value.find(e=>e.id===_.value);a?(b.value=a.name||"",y.value=a.contactPerson||"",N.value=a.email||"",w.value=a.phone||""):(b.value="",y.value="",N.value="",w.value="")}const U=c(""),g=c([{title:"",fields:[{label:"",unitPrice:0,quantity:1,type:"text",unit:"unidad"}]}]);function I(){g.value.push({title:"",fields:[{label:"",unitPrice:0,quantity:1,type:"text",unit:"unidad"}]})}function R(a){g.value.splice(a,1)}function K(a){g.value[a].fields.push({label:"",unitPrice:0,quantity:1,type:"text",unit:"unidad"})}function H(a,e){g.value[a].fields.splice(e,1)}async function J(){const a=re($(j,"formularios"),ue("cotizacionId","desc"),se(1)),e=await G(a);let o=1;return e.empty||(o=(e.docs[0].data().cotizacionId||0)+1),{cotizacionId:o,version:"01"}}async function Q(){try{const a=$(j,"formularios"),{cotizacionId:e,version:o}=await J(),n=g.value.map(v=>{let q=0;const ee=v.fields.map(T=>{const z=(T.unitPrice||0)*(T.quantity||0);return q+=z,{...T,total:z}});return{title:v.title,fields:ee,totalSection:q}}),l=n.reduce((v,q)=>v+q.totalSection,0),V=l*(f.value/100),s=l+V,O=s*.19,Z=s+O;await le(a,{name:U.value,companyName:b.value||"",attentionName:y.value||"",emailName:N.value||"",contacName:w.value||"",textSections:S.value||[],sections:n,totalPorSeccion:n.map(v=>v.totalSection),totalGeneral:l,utilidadPorcentaje:f.value,resumenFinanciero:{gastosSSO:V,neto:s,iva:O,totalFinal:Z},cotizacionId:e,version:o,createdAt:ne()}),alert("Formulario guardado exitosamente ✅"),U.value="",b.value="",y.value="",S.value=[],g.value=[{title:"",fields:[{label:"",unitPrice:0,quantity:1}]}],f.value=20}catch(a){console.error("Error al guardar el formulario:",a),alert("Hubo un error al guardar el formulario ❌")}}const E=x(()=>g.value.map(a=>a.fields.reduce((e,o)=>e+(Number(o.unitPrice)||0)*(Number(o.quantity)||0),0))),M=x(()=>E.value.reduce((a,e)=>a+e,0)),f=c(20),F=x(()=>M.value*(f.value/100)),P=x(()=>M.value+F.value),A=x(()=>P.value*.19),W=x(()=>P.value+A.value),S=c([{content:""}]);function X(){S.value.push({content:""})}function Y(a){S.value.splice(a,1)}return(a,e)=>(d(),u(h,null,[t("button",{onClick:e[0]||(e[0]=o=>a.$router.push("/menu")),class:"bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded transition m-5"}," Volver a página principal "),t("main",ie,[e[26]||(e[26]=t("h1",{class:"text-3xl font-semibold mb-6 text-gray-200"},"Crear Nuevo Formulario",-1)),t("form",{onSubmit:oe(Q,["prevent"]),class:"space-y-8"},[t("div",de,[e[9]||(e[9]=t("label",{for:"clientSelect",class:"block mb-1 font-medium"},"Seleccionar Cliente",-1)),r(t("select",{id:"clientSelect","onUpdate:modelValue":e[1]||(e[1]=o=>_.value=o),onChange:D,class:"w-full rounded border border-gray-700 bg-gray-900 px-3 py-2 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-gray-500 text-gray-200"},[e[8]||(e[8]=t("option",{value:""},"-- Selecciona un cliente --",-1)),(d(!0),u(h,null,k(C.value,o=>(d(),u("option",{key:o.id,value:o.id},m(o.name),9,ce))),128))],544),[[L,_.value]])]),t("div",null,[e[10]||(e[10]=t("label",{for:"formName",class:"block text-gray-400 font-medium mb-2"},"Nombre del formulario",-1)),r(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>U.value=o),id:"formName",type:"text",placeholder:"Ej: Encuesta de satisfacción",required:"",class:"w-full border border-gray-700 bg-gray-800 rounded-md px-4 py-2 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-gray-500 transition text-gray-200"},null,512),[[i,U.value]])]),t("div",me,[e[15]||(e[15]=t("h2",{class:"text-lg font-semibold mb-4"},"Información de la empresa",-1)),t("div",ge,[e[11]||(e[11]=t("label",{for:"companyName",class:"block mb-1 font-medium"},"Nombre de la empresa/entidad",-1)),r(t("input",{id:"companyName","onUpdate:modelValue":e[3]||(e[3]=o=>b.value=o),type:"text",placeholder:"Ej: ACME Ltda.",class:"w-full rounded border border-gray-700 bg-gray-900 px-3 py-2 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-gray-500"},null,512),[[i,b.value]])]),t("div",pe,[e[12]||(e[12]=t("label",{for:"attentionName",class:"block mb-1 font-medium"},"Atención a",-1)),r(t("input",{id:"attentionName","onUpdate:modelValue":e[4]||(e[4]=o=>y.value=o),type:"text",placeholder:"Ej: Juan Pérez",class:"w-full rounded border border-gray-700 bg-gray-900 px-3 py-2 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-gray-500"},null,512),[[i,y.value]])]),t("div",be,[e[13]||(e[13]=t("label",{for:"emailName",class:"block mb-1 font-medium"},"Email",-1)),r(t("input",{id:"emailName","onUpdate:modelValue":e[5]||(e[5]=o=>N.value=o),type:"text",placeholder:"Ej: FME@gmail.com",class:"w-full rounded border border-gray-700 bg-gray-900 px-3 py-2 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-gray-500"},null,512),[[i,N.value]])]),t("div",ye,[e[14]||(e[14]=t("label",{for:"contacName",class:"block mb-1 font-medium"},"Contacto",-1)),r(t("input",{id:"contacName","onUpdate:modelValue":e[6]||(e[6]=o=>w.value=o),type:"text",placeholder:"Ej: FME@gmail.com",class:"w-full rounded border border-gray-700 bg-gray-900 px-3 py-2 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-gray-500"},null,512),[[i,w.value]])])]),t("div",fe,[e[16]||(e[16]=t("h2",{class:"text-xl font-semibold text-gray-200 mb-4"},"Secciones de Texto",-1)),(d(!0),u(h,null,k(S.value,(o,n)=>(d(),u("div",{key:n,class:"mb-4 relative"},[r(t("textarea",{"onUpdate:modelValue":l=>o.content=l,rows:"4",placeholder:"Escribe aquí detalles o descripción",class:"w-full rounded border border-gray-700 bg-gray-800 px-4 py-2 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-gray-500 text-gray-200"},null,8,ve),[[i,o.content]]),t("button",{type:"button",onClick:l=>Y(n),class:"absolute top-0 right-0 mt-1 mr-1 text-red-500 hover:text-red-700 font-bold text-xl","aria-label":"Eliminar sección de texto"}," × ",8,xe)]))),128)),t("button",{type:"button",onClick:X,class:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded text-gray-200"}," + Agregar sección de texto ")]),(d(!0),u(h,null,k(g.value,(o,n)=>(d(),u("div",{key:n,class:"border border-gray-700 rounded p-4 mb-6"},[t("div",he,[r(t("input",{"onUpdate:modelValue":l=>o.title=l,type:"text",placeholder:"Título de la sección",class:"flex-grow rounded border border-gray-700 bg-gray-800 px-3 py-2 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-gray-500 text-gray-200",required:""},null,8,Ne),[[i,o.title]]),t("button",{type:"button",onClick:l=>R(n),class:"ml-4 text-red-500 hover:text-red-700 font-bold","aria-label":"Eliminar sección"}," × ",8,we)]),(d(!0),u(h,null,k(o.fields,(l,V)=>(d(),u("div",{key:V,class:"flex flex-col md:flex-row md:items-center md:space-x-4 mb-4"},[r(t("input",{"onUpdate:modelValue":s=>l.label=s,type:"text",placeholder:"Nombre del producto",class:"flex-grow rounded border border-gray-700 bg-gray-800 px-3 py-2 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-gray-500 text-gray-200 mb-2 md:mb-0",required:""},null,8,Se),[[i,l.label]]),t("div",Ve,[r(t("input",{"onUpdate:modelValue":s=>l.quantity=s,type:"number",min:"1",placeholder:"Cantidad",class:"w-25 text-center rounded border border-gray-700 bg-gray-800 px-3 py-2 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-gray-500 text-gray-200",required:""},null,8,ke),[[i,l.quantity,void 0,{number:!0}]])]),r(t("select",{"onUpdate:modelValue":s=>l.unit=s,class:"w-32 rounded border border-gray-700 bg-gray-800 px-3 py-2 text-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500 mb-2 md:mb-0"},e[17]||(e[17]=[ae('<option value="unidad">Unidad</option><option value="metro">Metro</option><option value="litro">Litro</option><option value="kg">Kg</option><option value="otro">Otro</option>',5)]),8,Ce),[[L,l.unit]]),r(t("input",{"onUpdate:modelValue":s=>l.unitPrice=s,type:"number",min:"0",step:"0.01",placeholder:"Valor unitario",class:"w-40 rounded border border-gray-700 bg-gray-800 px-3 py-2 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-gray-500 text-gray-200 mb-2 md:mb-0",required:""},null,8,Ue),[[i,l.unitPrice,void 0,{number:!0}]]),t("div",qe," Total: $"+m(Math.round((Number(l.unitPrice)||0)*(Number(l.quantity)||0))),1),t("button",{type:"button",onClick:s=>H(n,V),class:"ml-4 text-red-500 hover:text-red-700 font-bold text-xl","aria-label":"Eliminar producto"}," × ",8,_e)]))),128)),t("div",Ee," Total sección: $"+m(Math.round(p(E)[n]||0)),1),t("button",{type:"button",onClick:l=>K(n),class:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded text-gray-200"}," + Agregar producto ",8,Me)]))),128)),t("button",{type:"button",onClick:I,class:"px-6 py-3 bg-gray-800 hover:bg-gray-700 rounded text-gray-200 font-semibold"}," + Agregar sección "),t("div",Pe,[e[18]||(e[18]=t("h2",{class:"text-lg font-semibold text-gray-200 mb-3"},"Total de servicio",-1)),t("ul",Te,[(d(!0),u(h,null,k(p(E),(o,n)=>(d(),u("li",{key:n,class:"flex justify-between text-gray-300"},[t("span",null,m(g.value[n].title||`Sección ${n+1}`),1),t("span",null,"$ "+m(Math.round(o||0)),1)]))),128))]),t("div",$e," TOTAL NETO: $"+m(Math.round(p(M)||0)),1)]),t("div",je,[e[24]||(e[24]=t("h2",{class:"text-lg font-semibold text-gray-200 mb-3"},"Resumen Financiero",-1)),t("ul",Fe,[t("li",Ae,[e[19]||(e[19]=t("span",null,"Gastos SSO, adm y util",-1)),r(t("input",{type:"number",min:"0",max:"100","onUpdate:modelValue":e[7]||(e[7]=o=>f.value=o),class:"w-16 rounded border border-gray-700 bg-gray-900 px-2 py-1 text-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500"},null,512),[[i,f.value,void 0,{number:!0}]]),e[20]||(e[20]=t("span",null,"%",-1)),t("span",Oe,"$ "+m(Math.round(p(F)||0)),1)]),t("li",ze,[e[21]||(e[21]=t("span",null,"Neto",-1)),t("span",null,"$ "+m(Math.round(p(P)||0)),1)]),t("li",Le,[e[22]||(e[22]=t("span",null,"IVA (19%)",-1)),t("span",null,"$ "+m(Math.round(p(A)||0)),1)]),t("li",Ge,[e[23]||(e[23]=t("span",null,"TOTAL",-1)),t("span",null,"$ "+m(Math.round(p(W)||0)),1)])])]),e[25]||(e[25]=t("div",null,[t("button",{type:"submit",class:"w-full py-3 bg-gray-800 hover:bg-gray-700 text-gray-200 font-semibold rounded-md transition"}," Guardar Formulario ")],-1))],32)])],64))}};export{Re as default};
